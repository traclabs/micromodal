!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.MicroModal=t()}(this,function(){"use strict"
var e=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},t=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o]
i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}(),o=function(e){if(Array.isArray(e)){for(var t=0,o=Array(e.length);t<e.length;t++)o[t]=e[t]
return o}return Array.from(e)}
return function(){var i=["a[href]","area[href]",'input:not([disabled]):not([type="hidden"]):not([aria-hidden])',"select:not([disabled]):not([aria-hidden])","textarea:not([disabled]):not([aria-hidden])","button:not([disabled]):not([aria-hidden])","iframe","object","embed","[contenteditable]",'[tabindex]:not([tabindex^="-"])'],n=function(){function n(t){var i=t.targetModal,a=t.triggers,r=void 0===a?[]:a,l=t.onShow,s=void 0===l?function(){}:l,c=t.onClose,d=void 0===c?function(){}:c,u=t.openTrigger,f=void 0===u?"data-micromodal-trigger":u,h=t.closeTrigger,v=void 0===h?"data-micromodal-close":h,m=t.disableScroll,g=void 0!==m&&m,b=t.disableFocus,y=void 0!==b&&b,p=t.awaitCloseAnimation,w=void 0!==p&&p,k=t.debugMode,E=void 0!==k&&k
t.id
e(this,n),this.modal=document.getElementById(i),this.config={debugMode:E,disableScroll:g,openTrigger:f,closeTrigger:v,onShow:s,onClose:d,awaitCloseAnimation:w,disableFocus:y},r.length>0&&this.registerTriggers.apply(this,o(r)),this.onClick=this.onClick.bind(this),this.onKeydown=this.onKeydown.bind(this),this.id=i
try{this.modal.classList.add("micromodal-initialized")}catch(e){throw"Could not initialize "+i}}return t(n,[{key:"registerTriggers",value:function(){for(var e=this,t=arguments.length,o=Array(t),i=0;i<t;i++)o[i]=arguments[i]
o.forEach(function(t){t.addEventListener("click",function(){return e.showModal()})})}},{key:"showModal",value:function(){if(this.modal.classList.contains("is-open"))return void(this.config.debugMode&&console.warn("Modal already open"))
r.push(this)
var e=this.modal.parentNode
e.removeChild(this.modal),e.appendChild(this.modal),this.activeElement=document.activeElement,this.modal.setAttribute("aria-hidden","false"),this.modal.classList.add("is-open"),this.setFocusToFirstNode(),this.scrollBehaviour("disable"),this.addEventListeners(),this.config.onShow(this.modal)}},{key:"closeModal",value:function(){var e=this
r=r.filter(function(t){return t.id!==e.id})
var t=this.modal
this.modal.setAttribute("aria-hidden","true"),this.removeEventListeners(),this.scrollBehaviour("enable"),this.config.onClose(this.modal),this.config.awaitCloseAnimation?this.modal.addEventListener("animationend",function e(){t.classList.remove("is-open"),t.removeEventListener("animationend",e,!1)},!1):t.classList.remove("is-open")}},{key:"scrollBehaviour",value:function(e){if(this.config.disableScroll){var t=document.querySelector("body")
switch(e){case"enable":Object.assign(t.style,{overflow:"initial",height:"initial"})
break
case"disable":Object.assign(t.style,{overflow:"hidden",height:"100vh"})}}}},{key:"addEventListeners",value:function(){this.modal.addEventListener("touchstart",this.onClick),this.modal.addEventListener("click",this.onClick)}},{key:"removeEventListeners",value:function(){this.modal.removeEventListener("touchstart",this.onClick),this.modal.removeEventListener("click",this.onClick)}},{key:"onClick",value:function(e){e.target.hasAttribute(this.config.closeTrigger)&&(this.closeModal(),e.preventDefault())}},{key:"onKeydown",value:function(e){9===e.keyCode&&this.maintainFocus(e)}},{key:"getFocusableNodes",value:function(){var e=this.modal.querySelectorAll(i)
return Object.keys(e).map(function(t){return e[t]})}},{key:"setFocusToFirstNode",value:function(){if(!this.config.disableFocus){var e=this.getFocusableNodes()
e.length&&e[0].focus()}}},{key:"maintainFocus",value:function(e){var t=this.getFocusableNodes()
if(this.modal.contains(document.activeElement)){var o=t.indexOf(document.activeElement)
e.shiftKey&&0===o&&(t[t.length-1].focus(),e.preventDefault()),e.shiftKey||o!==t.length-1||(t[0].focus(),e.preventDefault())}else t[0].focus()}}]),n}(),a=null,r=[],l=function(e,t){var o=[]
return e.forEach(function(e){var i=e.attributes[t].value
void 0===o[i]&&(o[i]=[]),o[i].push(e)}),o},s=function(e){if(!document.getElementById(e))return console.warn("MicroModal v0.4.1: ❗Seems like you have missed %c'"+e+"'","background-color: #f8f9fa;color: #50596c;font-weight: bold;","ID somewhere in your code. Refer example below to resolve it."),console.warn("%cExample:","background-color: #f8f9fa;color: #50596c;font-weight: bold;",'<div class="modal" id="'+e+'"></div>'),!1},c=function(e){if(e.length<=0)return console.warn("MicroModal v0.4.1: ❗Please specify at least one %c'micromodal-trigger'","background-color: #f8f9fa;color: #50596c;font-weight: bold;","data attribute."),console.warn("%cExample:","background-color: #f8f9fa;color: #50596c;font-weight: bold;",'<a href="#" data-micromodal-trigger="my-modal"></a>'),!1},d=function(e,t){if(c(e),!t)return!0
for(var o in t)s(o)
return!0},u=function(e){if(27===e.keyCode&&r.length>0){var t=r[r.length-1]
if("false"===t.modal.getAttribute("data-micromodal-close-on-esc"))return
t&&t.closeModal()}}
return{init:function(e){var t=Object.assign({},{openTrigger:"data-micromodal-trigger"},e),i=[].concat(o(document.querySelectorAll("["+t.openTrigger+"]"))),a=l(i,t.openTrigger)
if(!0!==t.debugMode||!1!==d(i,a)){for(var r in a){var s=a[r]
t.targetModal=r,t.triggers=[].concat(o(s)),new n(t)}document.addEventListener("keydown",u)}},show:function(e,t){var o=t||{}
o.targetModal=e.replace(/^#/,""),!0===o.debugMode&&!1===s(e)||(a=new n(o),a.showModal())},close:function(e){var t={}
e?(e=e.replace(/^#/,""),t=r.filter(function(t){return t.id===e})[0]):t=r[r.length-1]
try{t.closeModal()}catch(t){console.warn("Cannot call close on Modal",e)}},initialized:function(e){var t
return e=e.replace(/^#/,""),null!==(t=document.getElementById(e))&&!!t.classList.contains("micromodal-initialized")}}}()})
